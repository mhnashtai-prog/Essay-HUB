<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>INTUITY ‚Äì Advanced Essay Mastery</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #0a0a0a;
      --beige: #C9A961;
      --beige-dim: rgba(201, 169, 97, 0.15);
      --beige-border: rgba(201, 169, 97, 0.25);
      --blue: #4a90e2;
      --red: #b94e48;
      --panel: rgba(28, 28, 30, 0.85);
      --text: #e5e5e7;
      --muted: #8e8e93;
      --border: rgba(255, 255, 255, 0.06);
    }

    body {
      background: #0a0a0a;
      font-family: 'DM Sans', -apple-system, sans-serif;
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    /* ULTRA-COMPACT HEADER */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 48px;
      background: rgba(10, 10, 10, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 1000;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Space Grotesk', sans-serif;
    }

    .logo {
      width: 28px;
      height: 28px;
      background: radial-gradient(circle at 30% 30%, rgba(201, 169, 97, 0.2), transparent);
      border: 1px solid var(--beige-border);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      color: var(--beige);
      letter-spacing: -0.5px;
    }

    .brand-name {
      font-size: 15px;
      font-weight: 700;
      color: var(--beige);
      letter-spacing: 0.5px;
    }

    .level-toggle {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--panel);
      padding: 4px;
      border-radius: 20px;
      border: 1px solid var(--border);
    }

    .level-btn {
      padding: 4px 12px;
      font-size: 11px;
      font-weight: 600;
      background: transparent;
      border: none;
      color: var(--muted);
      cursor: pointer;
      border-radius: 16px;
      transition: all 0.2s ease;
      letter-spacing: 0.3px;
    }

    .level-btn.active {
      background: var(--beige);
      color: #0a0a0a;
      box-shadow: 0 2px 8px rgba(201, 169, 97, 0.3);
    }

    .level-btn:hover:not(.active) {
      color: var(--beige);
    }

    /* Mode Navigation - 5 buttons now */
    .mode-nav {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    .mode-btn {
      width: 36px;
      height: 36px;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      color: var(--muted);
    }

    .mode-btn:hover {
      border-color: var(--beige-border);
      background: var(--beige-dim);
      transform: translateY(-1px);
    }

    .mode-btn.active {
      background: var(--beige-dim);
      border-color: var(--beige-border);
      color: var(--beige);
    }

    .mode-btn::after {
      content: attr(data-label);
      position: absolute;
      bottom: -28px;
      left: 50%;
      transform: translateX(-50%) scale(0.9);
      background: rgba(10, 10, 10, 0.95);
      color: var(--beige);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: all 0.2s ease;
      border: 1px solid var(--beige-border);
    }

    .mode-btn:hover::after {
      opacity: 1;
      transform: translateX(-50%) scale(1);
    }

    .menu-btn {
      width: 36px;
      height: 36px;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 3px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .menu-btn:hover {
      border-color: var(--beige-border);
      background: var(--beige-dim);
    }

    .menu-btn span {
      width: 16px;
      height: 2px;
      background: var(--muted);
      border-radius: 2px;
      transition: all 0.2s ease;
    }

    .menu-btn:hover span {
      background: var(--beige);
    }

    /* Main Content */
    .main-content {
      margin-top: 48px;
      min-height: calc(100vh - 48px);
      padding: 30px 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .mode-screen {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .mode-screen.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Welcome Screen */
    .welcome {
      text-align: center;
      max-width: 800px;
      margin: 60px auto;
    }

    .welcome h1 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2.5rem;
      color: var(--beige);
      margin-bottom: 12px;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .welcome .subtitle {
      font-size: 1rem;
      color: var(--muted);
      margin-bottom: 40px;
      line-height: 1.6;
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-top: 40px;
    }

    .feature-card {
      background: var(--panel);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .feature-card:hover {
      border-color: var(--beige-border);
      transform: translateY(-4px);
      box-shadow: 0 8px 30px rgba(201, 169, 97, 0.1);
    }

    .feature-icon {
      font-size: 2rem;
      margin-bottom: 12px;
    }

    .feature-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--beige);
      margin-bottom: 8px;
    }

    .feature-desc {
      font-size: 0.9rem;
      color: var(--muted);
      line-height: 1.5;
    }

    .stats-bar {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 50px;
      padding: 20px;
      background: var(--panel);
      border-radius: 12px;
      border: 1px solid var(--border);
      flex-wrap: wrap;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--beige);
      font-family: 'Space Grotesk', sans-serif;
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 4px;
    }

    /* Paragraph Generator Mode */
    .generator-layout {
      display: grid;
      grid-template-columns: 350px 1fr;
      gap: 20px;
      height: calc(100vh - 128px);
    }

    .section-selector {
      background: var(--panel);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      overflow-y: auto;
    }

    .section-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.2rem;
      color: var(--beige);
      margin-bottom: 16px;
    }

    .section-tabs {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 20px;
    }

    .section-tab {
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--muted);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-tab:hover {
      border-color: var(--beige-border);
      background: var(--beige-dim);
    }

    .section-tab.active {
      background: var(--beige-dim);
      border-color: var(--beige-border);
      color: var(--beige);
      font-weight: 600;
    }

    .section-icon {
      font-size: 1.2rem;
    }

    .expressions-list {
      margin-top: 20px;
    }

    .expression-category {
      margin-bottom: 20px;
    }

    .category-header {
      font-size: 0.85rem;
      color: var(--beige);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }

    .expression-item {
      padding: 10px 12px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.9rem;
      color: var(--text);
    }

    .expression-item:hover {
      border-color: var(--beige-border);
      background: var(--beige-dim);
      transform: translateX(4px);
    }

    .expression-item:active {
      transform: translateX(4px) scale(0.98);
    }

    .expression-usage {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 4px;
      font-style: italic;
    }

    .writing-area-container {
      background: var(--panel);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .writing-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .writing-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.2rem;
      color: var(--beige);
    }

    .writing-actions {
      display: flex;
      gap: 10px;
    }

    .action-btn {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--muted);
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85rem;
      transition: all 0.2s ease;
    }

    .action-btn:hover {
      border-color: var(--beige-border);
      background: var(--beige-dim);
      color: var(--beige);
    }

    .action-btn.primary {
      background: var(--beige);
      color: #0a0a0a;
      border-color: var(--beige);
    }

    .action-btn.primary:hover {
      background: #b39554;
    }

    #paragraphArea {
      flex: 1;
      width: 100%;
      background: rgba(10, 10, 10, 0.8);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      color: var(--text);
      font-size: 1rem;
      line-height: 1.8;
      font-family: 'DM Sans', sans-serif;
      resize: none;
      outline: none;
    }

    #paragraphArea:focus {
      border-color: var(--beige-border);
      box-shadow: 0 0 0 3px var(--beige-dim);
    }

    .word-count {
      margin-top: 12px;
      font-size: 0.85rem;
      color: var(--muted);
      text-align: right;
    }

    /* Placeholder styles */
    .learn-content,
    .practice-content,
    .structures-content,
    .write-content {
      background: var(--panel);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 40px;
      text-align: center;
    }

    .mode-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2rem;
      color: var(--beige);
      margin-bottom: 16px;
    }

    .mode-description {
      color: var(--muted);
      font-size: 1rem;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    .coming-soon {
      display: inline-block;
      padding: 12px 24px;
      background: var(--beige-dim);
      border: 1px solid var(--beige-border);
      border-radius: 8px;
      color: var(--beige);
      font-weight: 600;
      font-size: 0.9rem;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .generator-layout {
        grid-template-columns: 1fr;
        height: auto;
      }

      .section-selector {
        max-height: 400px;
      }

      .writing-area-container {
        min-height: 500px;
      }
    }

    @media (max-width: 768px) {
      .header {
        padding: 0 12px;
      }

      .brand-name {
        display: none;
      }

      .mode-nav {
        gap: 2px;
      }

      .mode-btn {
        width: 32px;
        height: 32px;
        font-size: 14px;
      }

      .level-btn {
        padding: 4px 10px;
        font-size: 10px;
      }

      .feature-grid {
        grid-template-columns: 1fr;
      }

      .stats-bar {
        flex-direction: column;
        gap: 16px;
      }
    }

    body.level-b2 .mode-btn[data-mode="structures"] {
      display: none;
    }
  </style>
</head>
<body class="level-b2">

  <header class="header">
    <div class="brand">
      <div class="logo">IN</div>
      <div class="brand-name">INTUITY</div>
    </div>

    <div class="level-toggle">
      <button class="level-btn active" data-level="b2">B2</button>
      <button class="level-btn" data-level="c1-c2">C1/C2</button>
    </div>

    <div class="mode-nav">
      <button class="mode-btn active" data-mode="home" data-label="Home">üè†</button>
      <button class="mode-btn" data-mode="learn" data-label="Learn Expressions">üìö</button>
      <button class="mode-btn" data-mode="practice" data-label="Practice">üéØ</button>
      <button class="mode-btn" data-mode="structures" data-label="Sentence Structures">üèóÔ∏è</button>
      <button class="mode-btn" data-mode="write" data-label="Essay Builder">‚úçÔ∏è</button>
      <button class="mode-btn" data-mode="generate" data-label="Paragraph Generator">üìù</button>
    </div>

    <button class="menu-btn" aria-label="Menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </header>

  <main class="main-content">
    <div class="container">

      <!-- HOME SCREEN -->
      <div class="mode-screen active" data-screen="home">
        <div class="welcome">
          <h1>Master Advanced Essay Writing</h1>
          <p class="subtitle">
            Build sophisticated arguments with precise expressions, complex sentence structures, and confident academic style. 
            From B2 proficiency to C2 mastery.
          </p>

          <div class="feature-grid">
            <div class="feature-card" data-goto="learn">
              <div class="feature-icon">üìö</div>
              <div class="feature-title">Learn Expressions</div>
              <div class="feature-desc">
                Master 106 key phrases for advantages, disadvantages, arguments, and balanced conclusions
              </div>
            </div>

            <div class="feature-card" data-goto="practice">
              <div class="feature-icon">üéØ</div>
              <div class="feature-title">Practice & Test</div>
              <div class="feature-desc">
                Comprehensive multiple-choice exercises with instant feedback and progress tracking
              </div>
            </div>

            <div class="feature-card" data-goto="structures">
              <div class="feature-icon">üèóÔ∏è</div>
              <div class="feature-title">Sentence Structures</div>
              <div class="feature-desc">
                Advanced patterns: participles, inversions, cleft sentences (C1/C2)
              </div>
            </div>

            <div class="feature-card" data-goto="write">
              <div class="feature-icon">‚úçÔ∏è</div>
              <div class="feature-title">Essay Builder</div>
              <div class="feature-desc">
                Build complete essays with smart suggestions and real-time preview
              </div>
            </div>

            <div class="feature-card" data-goto="generate">
              <div class="feature-icon">üìù</div>
              <div class="feature-title">Paragraph Generator</div>
              <div class="feature-desc">
                <strong>Focus on one section at a time:</strong> intro, body, conclusion
              </div>
            </div>
          </div>

          <div class="stats-bar">
            <div class="stat">
              <div class="stat-value">106</div>
              <div class="stat-label">Expressions</div>
            </div>
            <div class="stat">
              <div class="stat-value">10</div>
              <div class="stat-label">Structures</div>
            </div>
            <div class="stat">
              <div class="stat-value">4</div>
              <div class="stat-label">Categories</div>
            </div>
            <div class="stat">
              <div class="stat-value">5</div>
              <div class="stat-label">Modes</div>
            </div>
          </div>
        </div>
      </div>

      <!-- LEARN SCREEN -->
      <div class="mode-screen" data-screen="learn">
        <div class="learn-content">
          <h2 class="mode-title">üìö Learn Expressions</h2>
          <p class="mode-description">
            Interactive flashcards with examples, usage notes, and category filters.
          </p>
          <div class="coming-soon">Flashcard interface coming soon</div>
        </div>
      </div>

      <!-- PRACTICE SCREEN -->
      <div class="mode-screen" data-screen="practice">
        <div class="practice-content">
          <h2 class="mode-title">üéØ Practice & Test</h2>
          <p class="mode-description">
            Test your knowledge with comprehensive multiple-choice exercises.
          </p>
          <div class="coming-soon">Practice interface coming soon</div>
        </div>
      </div>

      <!-- STRUCTURES SCREEN -->
      <div class="mode-screen" data-screen="structures">
        <div class="structures-content">
          <h2 class="mode-title">üèóÔ∏è Sentence Structures</h2>
          <p class="mode-description">
            Master advanced sentence patterns that distinguish C1/C2 writing.
          </p>
          <div class="coming-soon">Structure patterns coming soon</div>
        </div>
      </div>

      <!-- WRITE SCREEN -->
      <div class="mode-screen" data-screen="write">
        <div class="write-content">
          <h2 class="mode-title">‚úçÔ∏è Essay Builder</h2>
          <p class="mode-description">
            Build complete essays with smart expression suggestions.
          </p>
          <div class="coming-soon">Essay builder interface coming soon</div>
        </div>
      </div>

      <!-- PARAGRAPH GENERATOR SCREEN -->
      <div class="mode-screen" data-screen="generate">
        <div class="generator-layout">
          <!-- Left Panel: Section Selector & Expressions -->
          <div class="section-selector">
            <div class="section-title">Essay Section</div>
            
            <div class="section-tabs">
              <div class="section-tab active" data-section="introduction">
                <span class="section-icon">üéØ</span>
                <span>Introduction</span>
              </div>
              <div class="section-tab" data-section="body1">
                <span class="section-icon">üí°</span>
                <span>Body Paragraph 1</span>
              </div>
              <div class="section-tab" data-section="body2">
                <span class="section-icon">üí°</span>
                <span>Body Paragraph 2</span>
              </div>
              <div class="section-tab" data-section="body3">
                <span class="section-icon">üí°</span>
                <span>Body Paragraph 3</span>
              </div>
              <div class="section-tab" data-section="conclusion">
                <span class="section-icon">‚úÖ</span>
                <span>Conclusion</span>
              </div>
            </div>

            <div class="expressions-list" id="expressionsList">
              <!-- Dynamically loaded expressions will appear here -->
              <div class="expression-category">
                <div class="category-header">Loading expressions...</div>
              </div>
            </div>
          </div>

          <!-- Right Panel: Writing Area -->
          <div class="writing-area-container">
            <div class="writing-header">
              <div class="writing-title" id="currentSectionTitle">Introduction</div>
              <div class="writing-actions">
                <button class="action-btn" id="clearBtn">Clear</button>
                <button class="action-btn" id="copyBtn">Copy</button>
                <button class="action-btn primary" id="saveBtn">üíæ Save</button>
              </div>
            </div>

            <textarea id="paragraphArea" placeholder="Start writing your paragraph here. Click expressions on the left to insert them..."></textarea>

            <div class="word-count">
              <span id="wordCount">0 words</span> ‚Ä¢ 
              <span id="charCount">0 characters</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <script>
    // State
    let currentLevel = 'b2';
    let currentMode = 'home';
    let currentSection = 'introduction';
    let expressionsData = {};

    // DOM Elements
    const levelBtns = document.querySelectorAll('.level-btn');
    const modeBtns = document.querySelectorAll('.mode-btn');
    const modeScreens = document.querySelectorAll('.mode-screen');
    const featureCards = document.querySelectorAll('.feature-card');
    
    // Generator elements
    const sectionTabs = document.querySelectorAll('.section-tab');
    const expressionsList = document.getElementById('expressionsList');
    const paragraphArea = document.getElementById('paragraphArea');
    const currentSectionTitle = document.getElementById('currentSectionTitle');
    const wordCount = document.getElementById('wordCount');
    const charCount = document.getElementById('charCount');
    const clearBtn = document.getElementById('clearBtn');
    const copyBtn = document.getElementById('copyBtn');
    const saveBtn = document.getElementById('saveBtn');

    // Level Toggle
    levelBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        levelBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        currentLevel = btn.dataset.level;
        document.body.className = `level-${currentLevel}`;
        
        showNotification(`Level switched to ${btn.textContent}`);
        
        // Reload expressions if in generator mode
        if (currentMode === 'generate') {
          loadExpressionsForSection(currentSection);
        }
      });
    });

    // Mode Navigation
    modeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const mode = btn.dataset.mode;
        switchMode(mode);
      });
    });

    // Feature Cards Navigation
    featureCards.forEach(card => {
      card.addEventListener('click', () => {
        const goto = card.dataset.goto;
        if (goto) switchMode(goto);
      });
    });

    // Switch Mode Function
    function switchMode(mode) {
      if (mode === 'structures' && currentLevel === 'b2') {
        showNotification('‚ö†Ô∏è Sentence Structures available only for C1/C2');
        return;
      }

      currentMode = mode;

      modeBtns.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.mode === mode);
      });

      modeScreens.forEach(screen => {
        screen.classList.toggle('active', screen.dataset.screen === mode);
      });

      // Load expressions when entering generator mode
      if (mode === 'generate') {
        loadExpressionsForSection(currentSection);
      }

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Section Tab Switching
    sectionTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        sectionTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        currentSection = tab.dataset.section;
        updateSectionTitle();
        loadExpressionsForSection(currentSection);
      });
    });

    // Update Section Title
    function updateSectionTitle() {
      const titles = {
        'introduction': 'Introduction',
        'body1': 'Body Paragraph 1',
        'body2': 'Body Paragraph 2',
        'body3': 'Body Paragraph 3',
        'conclusion': 'Conclusion'
      };
      currentSectionTitle.textContent = titles[currentSection] || 'Paragraph';
    }

    // Load Expressions for Section
    async function loadExpressionsForSection(section) {
      const levelFolder = currentLevel === 'b2' ? 'B2' : 'C1-C2';
      
      try {
        // Determine which categories to load based on section
        let categories = [];
        
        if (section === 'introduction') {
          categories = ['balancing']; // Opening statements, thesis
        } else if (section.startsWith('body')) {
          categories = ['advantages', 'disadvantages', 'arguments']; // Main content
        } else if (section === 'conclusion') {
          categories = ['balancing']; // Concluding statements
        }

        // Load all needed categories
        expressionsList.innerHTML = '<div class="category-header">Loading...</div>';
        
        const loadedExpressions = [];
        
        for (const category of categories) {
          try {
            const response = await fetch(`data/${levelFolder}/${category}.json`);
            if (response.ok) {
              const data = await response.json();
              loadedExpressions.push({ category, data });
            }
          } catch (error) {
            console.error(`Error loading ${category}:`, error);
          }
        }

        // Render expressions
        renderExpressions(loadedExpressions, section);
        
      } catch (error) {
        expressionsList.innerHTML = '<div style="color:var(--red);padding:20px;">Error loading expressions</div>';
      }
    }

    // Render Expressions
    function renderExpressions(categoriesData, section) {
      expressionsList.innerHTML = '';
      
      if (categoriesData.length === 0) {
        expressionsList.innerHTML = '<div style="color:var(--muted);padding:20px;">No expressions available</div>';
        return;
      }

      categoriesData.forEach(({ category, data }) => {
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'expression-category';
        
        const header = document.createElement('div');
        header.className = 'category-header';
        header.textContent = category.charAt(0).toUpperCase() + category.slice(1);
        categoryDiv.appendChild(header);

        // Filter expressions based on section
        let filteredExpressions = data.expressions || [];
        
        if (section === 'introduction' && category === 'balancing') {
          // Show thesis and opening statements
          filteredExpressions = filteredExpressions.slice(0, 6);
        } else if (section === 'conclusion' && category === 'balancing') {
          // Show concluding expressions
          filteredExpressions = filteredExpressions.filter(expr => 
            expr.expression.includes('conclusion') || 
            expr.expression.includes('Taking everything') ||
            expr.expression.includes('balance') ||
            expr.id.includes('bal-006') || expr.id.includes('bal-007') || 
            expr.id.includes('bal-009') || expr.id.includes('bal-010')
          );
        }

        filteredExpressions.forEach(expr => {
          const item = document.createElement('div');
          item.className = 'expression-item';
          item.innerHTML = `
            <div>${expr.expression}</div>
            ${expr.usage ? `<div class="expression-usage">${expr.usage}</div>` : ''}
          `;
          
          item.addEventListener('click', () => {
            insertExpression(expr.expression);
          });
          
          categoryDiv.appendChild(item);
        });

        expressionsList.appendChild(categoryDiv);
      });
    }

    // Insert Expression into Textarea
    function insertExpression(text) {
      const textarea = paragraphArea;
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const currentText = textarea.value;
      
      // Smart insertion
      let insertText = text;
      if (currentText && !currentText.endsWith(' ') && !currentText.endsWith('\n')) {
        insertText = ' ' + text;
      }
      if (!text.endsWith('...') && !text.endsWith('_')) {
        insertText += ' ';
      }
      
      textarea.value = currentText.substring(0, start) + insertText + currentText.substring(end);
      textarea.focus();
      textarea.selectionStart = textarea.selectionEnd = start + insertText.length;
      
      updateWordCount();
      showNotification('‚úì Expression inserted');
    }

    // Word Count
    paragraphArea.addEventListener('input', updateWordCount);
    
    function updateWordCount() {
      const text = paragraphArea.value;
      const words = text.trim().split(/\s+/).filter(w => w.length > 0).length;
      const chars = text.length;
      
      wordCount.textContent = `${words} word${words !== 1 ? 's' : ''}`;
      charCount.textContent = `${chars} character${chars !== 1 ? 's' : ''}`;
    }

    // Clear Button
    clearBtn.addEventListener('click', () => {
      if (confirm('Clear all text in this section?')) {
        paragraphArea.value = '';
        updateWordCount();
        showNotification('‚úì Text cleared');
      }
    });

    // Copy Button
    copyBtn.addEventListener('click', () => {
      paragraphArea.select();
      document.execCommand('copy');
      showNotification('‚úì Copied to clipboard');
    });

    // Save Button
    saveBtn.addEventListener('click', () => {
      const text = paragraphArea.value;
      if (!text.trim()) {
        showNotification('‚ö†Ô∏è Nothing to save');
        return;
      }
      
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `INTUITY_${currentLevel}_${currentSection}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('‚úì Saved successfully');
    });

    // Notification System
    function showNotification(message) {
      const existing = document.querySelector('.notification');
      if (existing) existing.remove();

      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed;
        top: 60px;
        right: 20px;
        background: rgba(201, 169, 97, 0.95);
        color: #0a0a0a;
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        z-index: 2000;
        animation: slideInRight 0.3s ease, slideOutRight 0.3s ease 2s forwards;
        box-shadow: 0 4px 20px rgba(201, 169, 97, 0.3);
      `;
      
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 2500);
    }

    // Animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideInRight {
        from { transform: translateX(400px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(400px); opacity: 0; }
      }
    `;
    document.head.appendChild(style);

    // Keyboard Shortcuts
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '6') {
        e.preventDefault();
        const modes = ['home', 'learn', 'practice', 'structures', 'write', 'generate'];
        const index = parseInt(e.key) - 1;
        if (modes[index]) switchMode(modes[index]);
      }
      
      if (e.key === 'Escape') {
        switchMode('home');
      }
    });

    // Menu Button
    document.querySelector('.menu-btn').addEventListener('click', () => {
      showNotification('üìã Settings & Export menu coming soon');
    });

    console.log('üöÄ INTUITY Enhanced initialized');
    console.log('üí° Keyboard shortcuts: Ctrl+1-6 to switch modes');
  </script>

</body>
</html>
